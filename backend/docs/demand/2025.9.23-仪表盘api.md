# 仪表盘 API 设计

## 1. 授权趋势统计 API

### 1.1 获取授权趋势数据
```http
GET /api/v1/dashboard/authorization-trend
```

**查询参数**
- `type` - 时间类型 (week/month/custom) 必填
- `start_date` - 开始日期 (YYYY-MM-DD格式，当type为custom时必填)
- `end_date` - 结束日期 (YYYY-MM-DD格式，当type为custom时必填)
- `timezone` - 时区 (可选，如：Asia/Shanghai、UTC等，默认使用服务器本地时区)

**参数说明：**
- `week`: 返回本周每日的授权总数（周一到周日）
- `month`: 返回本月每日的授权总数（1号到当月最后一天）
- `custom`: 返回指定时间段内每日授权总数，时间间隔不超过一年
- `timezone`: 指定时区，影响"本周"、"本月"以及自定义日期的计算基准。支持标准时区名称如Asia/Shanghai、America/New_York、UTC等

**响应**
```json
{
  "code": "000000",
  "message": "成功",
  "data": {
    "period": {
      "type": "week",
      "start_date": "2024-01-01",
      "end_date": "2024-01-07",
      "description_display": "本周"
    },
    "trend_data": [
      {
        "date": "2024-01-01",
        "total_authorizations": 15,
        "new_authorizations": 3,
        "expired_authorizations": 1
      },
      {
        "date": "2024-01-02",
        "total_authorizations": 17,
        "new_authorizations": 2,
        "expired_authorizations": 0
      }
    ],
    "summary": {
      "total_count": 120,
      "new_count": 15,
      "expired_count": 5,
      "growth_rate": 5.2
    }
  }
}
```

**响应字段说明：**
- `description_display` - 多语言

## 2. 最近授权列表 API

### 2.1 获取最近授权列表
```http
GET /api/v1/dashboard/recent-authorizations
```

**查询参数**
- `limit` - 返回数量限制（默认20，最大100）
- `customer_id` - 客户ID筛选（可选）
- `status` - 状态筛选 (normal/locked/expired) 可选

**响应**
```json
{
  "code": "000000",
  "message": "成功",
  "data": {
    "list": [
      {
        "id": "uuid-string",
        "code": "LIC-COMP001-A7B9X2-C8F4",
        "customer_id": "customer-uuid",
        "customer_name": "张三公司",
        "description": "企业版授权",
        "status": "normal",
        "status_display": "正常",
        "start_date": "2024-01-01T00:00:00Z",
        "end_date": "2024-12-31T23:59:59Z",
        "max_activations": 10,
        "current_activations": 7,
        "created_at": "2024-01-01T10:00:00Z",
        "updated_at": "2024-01-01T10:00:00Z"
      }
    ],
    "total": 20
  }
}
```

**响应字段说明：**
- `total` - 符合条件的授权总数量
- `list` - 当前返回的授权列表数据
- `status_display` - 多语言

## 3. 状态说明

### 3.1 授权码状态
- `normal` - 正常：当前时间在有效期内且未被锁定
- `locked` - 已锁定：is_locked=true
- `expired` - 已过期：当前时间超过end_date

### 3.2 时间类型
- `week` - 本周：从周一00:00:00到周日23:59:59 (基于指定时区)
- `month` - 本月：从1号00:00:00到当月最后一天23:59:59 (基于指定时区)
- `custom` - 自定义：指定开始和结束日期，最大跨度365天 (基于指定时区)

## 4. 错误码定义

- `400001` - 时间类型参数错误
- `400002` - 开始日期格式错误
- `400003` - 结束日期格式错误
- `400004` - 时间范围超过限制（超过一年）
- `400005` - 开始日期不能晚于结束日期
- `400006` - 数量限制参数错误