# 套餐管理需求

管理员端可以配置套餐，用户端从数据库查询套餐列表。

## 表设计

```sql
-- 套餐表
CREATE TABLE packages (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(100) NOT NULL COMMENT '套餐名称',
    type VARCHAR(20) NOT NULL COMMENT '套餐类型: trial-试用版, basic-基础版, professional-专业版, custom-定制版',
    price DECIMAL(10,2) NOT NULL DEFAULT 0 COMMENT '价格',
    price_description VARCHAR(100) DEFAULT '' COMMENT '价格描述，如"定制报价"',
    duration_description VARCHAR(200) DEFAULT '' COMMENT '期限描述，如"永久有效"、"当月25日到期"',
    description VARCHAR(500) DEFAULT '' COMMENT '套餐说明',
    features TEXT DEFAULT '' COMMENT '功能项，JSON格式: ["功能1", "功能2"]',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态: 1-启用, 0-禁用',
    sort_order INT NOT NULL DEFAULT 0 COMMENT '排序，数字越大越靠前',
    remark VARCHAR(500) DEFAULT '' COMMENT '备注',
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL,
    deleted_at DATETIME NULL,
    
    INDEX idx_packages_type (type),
    INDEX idx_packages_status (status),
    INDEX idx_packages_sort_order (sort_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='产品套餐表';
```

## 接口设计

### 管理端接口

#### 1. 获取套餐列表
```
GET /api/packages
```
**请求参数：**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| type | string | 否 | 套餐类型筛选 |
| status | int | 否 | 状态筛选，1-启用，0-禁用 |

**响应：**
```json
{
  "code": "000000",
  "data": [
    {
      "id": "uuid",
      "name": "试用版",
      "type": "trial",
      "price": 0,
      "price_description": "免费",
      "duration_description": "当月25日到期",
      "description": "免费体验全部功能",
      "features": ["全部功能", "1个许可"],
      "status": 1,
      "sort_order": 1
    }
  ]
}
```

#### 2. 创建套餐
```
POST /api/packages
```
**请求体：**
```json
{
  "name": "试用版",
  "type": "trial",
  "price": 0,
  "price_description": "免费",
  "duration_description": "当月25日到期",
  "description": "免费体验全部功能",
  "features": ["全部功能", "1个许可"],
  "status": 1,
  "sort_order": 1,
  "remark": ""
}
```

#### 3. 更新套餐
```
PUT /api/packages/{id}
```
**请求体：** 同创建接口

#### 4. 删除套餐
```
DELETE /api/packages/{id}
```

### 用户端接口

#### 获取套餐列表
```
GET /api/cu/packages
```
**说明：** 只返回启用状态的套餐，按 sort_order 排序，保持原有返回结构不变

**响应：** 与原有接口一致
```json
{
  "code": "000000",
  "data": [
    {
      "id": "trial",
      "name": "试用版",
      "type": "trial",
      "price": 0,
      "max_devices": 1,
      "description": "免费体验全部功能",
      "features": ["全部功能", "1个许可"],
      "details": "包含全部功能|试用期限制|1个许可等"
    }
  ]
}
```

## 套餐类型

| 类型 | 名称 | 说明 |
|------|------|------|
| trial | 试用版 | 免费，当月25日到期 |
| basic | 基础版 | 付费，永久有效 |
| professional | 专业版 | 付费，永久有效，全部功能 |
| custom | 定制版 | 定制报价，按需配置 |

## 实现文件

### 新建文件
- `backend/internal/models/package.go` - 套餐模型
- `backend/internal/repository/package_repository.go` - 套餐仓储
- `backend/internal/service/package_service.go` - 套餐服务
- `backend/internal/api/handlers/package_handler.go` - 管理端套餐处理器
- `backend/migrations/013_create_packages_table.sql` - 数据库迁移

### 修改文件
- `backend/internal/api/routes/router.go` - 添加路由
- `backend/internal/api/handlers/cu_order_handler.go` - 修改 GetPackages 从数据库查询
- `backend/internal/service/cu_order_service.go` - 修改 CalculatePrice 支持数据库套餐
