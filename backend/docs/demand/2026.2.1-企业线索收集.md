# 企业线索收集

从各个渠道收集用户线索，并进行跟进和转化。

## 表设计

```sql
-- 企业线索表
CREATE TABLE leads (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    lead_no VARCHAR(50) NOT NULL COMMENT '线索编号，系统生成',
    company_name VARCHAR(200) NOT NULL COMMENT '企业/机构名称',
    contact_name VARCHAR(100) NOT NULL COMMENT '联系人',
    contact_phone VARCHAR(20) NOT NULL COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '邮箱地址',
    requirement TEXT NOT NULL COMMENT '需求描述',
    extra_info TEXT COMMENT '补充信息',
    status VARCHAR(20) NOT NULL DEFAULT 'pending' COMMENT '状态: pending-待联系, contacted-已联系, converted-已成交, invalid-已失效',
    follow_up_date DATETIME COMMENT '跟进日期',
    follow_up_record TEXT COMMENT '跟进记录',
    internal_note TEXT COMMENT '内部备注',
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL,

    INDEX idx_leads_status (status),
    INDEX idx_leads_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='企业线索表';
```

## 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | VARCHAR(36) | 是 | 主键，UUID |
| lead_no | VARCHAR(50) | 是 | 线索编号，系统生成，格式：LEAD + 时间戳 + 6位随机数 |
| company_name | VARCHAR(200) | 是 | 企业/机构名称 |
| contact_name | VARCHAR(100) | 是 | 联系人姓名 |
| contact_phone | VARCHAR(20) | 是 | 联系电话 |
| contact_email | VARCHAR(100) | 否 | 邮箱地址 |
| requirement | TEXT | 是 | 需求描述 |
| extra_info | TEXT | 否 | 补充信息 |
| status | VARCHAR(20) | 是 | 状态：pending-待联系，contacted-已联系，converted-已成交，invalid-已失效 |
| follow_up_date | DATETIME | 否 | 跟进日期 |
| follow_up_record | TEXT | 否 | 跟进记录 |
| internal_note | TEXT | 否 | 内部备注 |
| created_at | DATETIME | 是 | 创建时间 |
| updated_at | DATETIME | 是 | 更新时间 |

## 状态流转

```
pending (待联系) → contacted (已联系) → converted (已成交)
                  ↓
                invalid (已失效)
```

## 接口设计

### 1. 新增线索（公开接口）
```
POST /api/leads
```
**无需鉴权**

**请求体：**
```json
{
  "company_name": "北京科技有限公司",
  "contact_name": "张三",
  "contact_phone": "13800138000",
  "contact_email": "zhangsan@example.com",
  "requirement": "需要采购50套软件授权",
  "extra_info": "希望了解批量购买优惠"
}
```

**响应：**
```json
{
  "code": "000000",
  "data": {
    "id": "uuid",
    "lead_no": "LEAD20260201123456ABC123",
    "company_name": "北京科技有限公司",
    "contact_name": "张三",
    "contact_phone": "13800138000",
    "contact_email": "zhangsan@example.com",
    "requirement": "需要采购50套软件授权",
    "status": "pending",
    "created_at": "2026-02-01T12:00:00Z"
  }
}
```

### 2. 线索列表（管理端）
```
GET /api/leads
```
**需要管理员鉴权**

**请求参数：**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | int | 否 | 页码，默认1 |
| page_size | int | 否 | 每页数量，默认10，最大100 |
| search | string | 否 | 关键词检索（企业名称/联系人/联系电话） |
| status | string | 否 | 状态筛选：pending/contacted/converted/invalid |

**响应：**
```json
{
  "code": "000000",
  "data": {
    "leads": [
      {
        "id": "uuid",
        "lead_no": "LEAD20260201123456ABC123",
        "company_name": "北京科技有限公司",
        "contact_name": "张三",
        "contact_phone": "13800138000",
        "status": "pending",
        "created_at": "2026-02-01T12:00:00Z"
      }
    ],
    "total_count": 100,
    "page": 1,
    "page_size": 10
  }
}
```

### 3. 线索详情（管理端）
```
GET /api/leads/{id}
```
**需要管理员鉴权**

**响应：**
```json
{
  "code": "000000",
  "data": {
    "id": "uuid",
    "lead_no": "LEAD20260201123456ABC123",
    "company_name": "北京科技有限公司",
    "contact_name": "张三",
    "contact_phone": "13800138000",
    "contact_email": "zhangsan@example.com",
    "requirement": "需要采购50套软件授权",
    "extra_info": "希望了解批量购买优惠",
    "status": "contacted",
    "follow_up_date": "2026-02-05T10:00:00Z",
    "follow_up_record": "已电话沟通，客户表示下周决策",
    "internal_note": "重点跟进客户",
    "created_at": "2026-02-01T12:00:00Z",
    "updated_at": "2026-02-05T10:00:00Z"
  }
}
```

### 4. 线索跟进（管理端）
```
PUT /api/leads/{id}
```
**需要管理员鉴权**

**请求体：**
```json
{
  "status": "contacted",
  "follow_up_date": "2026-02-05T10:00:00Z",
  "follow_up_record": "已电话沟通，客户表示下周决策",
  "internal_note": "重点跟进客户"
}
```

**响应：**
```json
{
  "code": "000000",
  "message": "成功"
}
```

### 5. 删除线索（管理端）
```
DELETE /api/leads/{id}
```
**需要管理员鉴权**

**响应：**
```json
{
  "code": "000000",
  "message": "成功"
}
```

## 实现文件

### 新建文件
- `backend/internal/models/lead.go` - 线索模型
- `backend/internal/repository/lead_repository.go` - 线索仓储
- `backend/internal/service/lead_service.go` - 线索服务
- `backend/internal/api/handlers/lead_handler.go` - 线索处理器
- `backend/migrations/014_create_leads_table.sql` - 数据库迁移

### 修改文件
- `backend/internal/api/routes/router.go` - 添加路由
- `backend/internal/database/migration.go` - 添加自动迁移和初始化
