# æ”¯ä»˜å®æ²™ç®±æµ‹è¯•æŒ‡å—

## ğŸ”§ é…ç½®å‡†å¤‡

### 1. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨æ•°æ®åº“å’Œåç«¯æœåŠ¡
cd backend
go run cmd/main.go
```

### 2. éªŒè¯é…ç½®
å¯åŠ¨åæ£€æŸ¥æ—¥å¿—ï¼Œç¡®è®¤æ”¯ä»˜å®SDKåˆå§‹åŒ–æˆåŠŸï¼š
```
[INFO] Alipay client initialized successfully
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1: åˆ›å»ºè®¢å•å¹¶æ”¯ä»˜

#### APIè¯·æ±‚
```bash
# 1. è·å–å¥—é¤åˆ—è¡¨
curl -X GET "http://localhost:18888/api/cu/packages" \
  -H "Content-Type: application/json"

# 2. è®¡ç®—ä»·æ ¼
curl -X POST "http://localhost:18888/api/cu/orders/calculate" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "package_id": "basic",
    "license_count": 1
  }'

# 3. åˆ›å»ºä»˜è´¹è®¢å•
curl -X POST "http://localhost:18888/api/cu/orders" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "package_id": "basic",
    "license_count": 1,
    "payment_method": "alipay"
  }'
```

#### é¢„æœŸå“åº”
```json
{
  "code": "000000",
  "message": "æˆåŠŸ",
  "data": {
    "id": "order_xxx",
    "order_no": "ORD20240101001",
    "payment_no": "PAY20240101001",
    "total_amount": 300.00,
    "status": "pending",
    "payment_url": "https://openapi-sandbox.dl.alipaydev.com/gateway.do?...",
    "expire_time": "2024-01-01T13:00:00Z"
  }
}
```

### æ­¥éª¤2: æ¨¡æ‹Ÿæ”¯ä»˜

#### æ–¹æ³•1: æµè§ˆå™¨è®¿é—®æ”¯ä»˜é“¾æ¥
1. å¤åˆ¶APIå“åº”ä¸­çš„ `payment_url`
2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¯¥é“¾æ¥
3. ä½¿ç”¨æ²™ç®±ä¹°å®¶è´¦å·ç™»å½•ï¼š
   - è´¦å·ï¼š`mgwlmn3858@sandbox.com`
   - å¯†ç ï¼š`111111`
   - æ”¯ä»˜å¯†ç ï¼š`111111`

#### æ–¹æ³•2: ä½¿ç”¨æ”¯ä»˜å®Appæ‰«ç 
å¦‚æœæ”¯ä»˜é“¾æ¥æ˜¯äºŒç»´ç ï¼Œå¯ä»¥ç”¨æ”¯ä»˜å®Appæ‰«ææ”¯ä»˜

### æ­¥éª¤3: éªŒè¯æ”¯ä»˜ç»“æœ

#### æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
```bash
curl -X GET "http://localhost:18888/api/payment/PAY20240101001/status" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### é¢„æœŸæˆåŠŸå“åº”
```json
{
  "code": "000000",
  "data": {
    "payment_no": "PAY20240101001",
    "status": "paid",
    "amount": 300.00,
    "payment_time": "2024-01-01T12:35:00Z",
    "trade_no": "20240101220014xxxxxx",
    "business_order": {
      "order_no": "ORD20240101001",
      "authorization_code": "AC-240101-XXXXXX",
      "status": "paid"
    }
  }
}
```

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ”¯ä»˜é“¾æ¥æ— æ³•è®¿é—®
- æ£€æŸ¥ `gateway_url` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ç½‘ç»œèƒ½è®¿é—®æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ

### 2. å›è°ƒå¤±è´¥
- æ£€æŸ¥ `notify_url` æ˜¯å¦å¯å…¬ç½‘è®¿é—®
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—ä¸­çš„å›è°ƒå¤„ç†ä¿¡æ¯

### 3. ç­¾åéªŒè¯å¤±è´¥
- ç¡®è®¤ç§é’¥æ ¼å¼æ­£ç¡®ï¼ˆPKCS8ï¼‰
- æ£€æŸ¥å…¬é’¥æ˜¯å¦åŒ¹é…

### 4. è®¢å•çŠ¶æ€æœªæ›´æ–°
- æ£€æŸ¥å›è°ƒURLé…ç½®
- æŸ¥çœ‹æ”¯ä»˜å®å›è°ƒæ—¥å¿—

## ğŸ“Š æµ‹è¯•æ•°æ®

### æ²™ç®±è´¦å·ä¿¡æ¯
- **ä¹°å®¶è´¦å·**: mgwlmn3858@sandbox.com / 111111
- **æ”¯ä»˜å¯†ç **: 111111
- **ä½™é¢**: 1,000,000.00

### æµ‹è¯•é‡‘é¢å»ºè®®
- å°é‡‘é¢æµ‹è¯•ï¼š0.01å…ƒ
- æ­£å¸¸é‡‘é¢æµ‹è¯•ï¼š1.00-100.00å…ƒ
- å¤§é‡‘é¢æµ‹è¯•ï¼š1000.00å…ƒ

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
# è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºdebug
log:
  level: "debug"
```

### 2. æ‰‹åŠ¨è§¦å‘å›è°ƒæµ‹è¯•
```bash
# æ¨¡æ‹Ÿæ”¯ä»˜å®å›è°ƒï¼ˆéœ€æ„é€ æ­£ç¡®çš„å›è°ƒå‚æ•°ï¼‰
curl -X POST "http://localhost:18888/api/payment/alipay/callback" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "å›è°ƒå‚æ•°..."
```

### 3. æ•°æ®åº“æ£€æŸ¥
```sql
-- æŸ¥çœ‹æ”¯ä»˜è®¢å•
SELECT * FROM payments WHERE payment_no = 'PAY20240101001';

-- æŸ¥çœ‹ä¸šåŠ¡è®¢å•
SELECT * FROM cu_orders WHERE order_no = 'ORD20240101001';
```

## âœ… æµ‹è¯• checklist

- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸï¼Œæ— é”™è¯¯æ—¥å¿—
- [ ] åˆ›å»ºä»˜è´¹è®¢å•APIè¿”å›æ”¯ä»˜é“¾æ¥
- [ ] æ”¯ä»˜é“¾æ¥å¯æ­£å¸¸è®¿é—®æ”¯ä»˜å®æ²™ç®±
- [ ] æ²™ç®±è´¦å·èƒ½æ­£å¸¸ç™»å½•å’Œæ”¯ä»˜
- [ ] æ”¯ä»˜å®Œæˆåè®¢å•çŠ¶æ€æ›´æ–°ä¸ºpaid
- [ ] æˆæƒç æ­£ç¡®ç”Ÿæˆ
- [ ] å›è°ƒæ—¥å¿—æ­£å¸¸ï¼Œæ— é”™è¯¯

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

æµ‹è¯•é€šè¿‡åï¼Œä¿®æ”¹é…ç½®ä¸ºç”Ÿäº§ç¯å¢ƒï¼š
1. æ›´æ¢ä¸ºæ­£å¼APPID
2. ä½¿ç”¨ç”Ÿäº§RSAå¯†é’¥å¯¹
3. ä¿®æ”¹ç½‘å…³åœ°å€ä¸ºæ­£å¼ç¯å¢ƒ
4. æ›´æ–°å›è°ƒURLä¸ºç”Ÿäº§åŸŸå
5. é…ç½®ç”Ÿäº§æ•°æ®åº“

---

**ğŸ‰ æŒ‰ç…§æ­¤æŒ‡å—æµ‹è¯•ï¼Œä½ çš„æ”¯ä»˜å®æ”¯ä»˜åŠŸèƒ½å°±èƒ½æ­£å¸¸å·¥ä½œäº†ï¼**
