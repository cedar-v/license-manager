# 注册发送验证码接口

## 概述

为注册流程提供手机号验证功能，用户在注册前需要先获取短信验证码进行手机号验证。

## 接口信息

- **接口路径**: `POST /api/cu/send-register-sms`
- **认证方式**: 无需认证（公开接口）
- **请求格式**: `application/json`
- **响应格式**: `application/json`

## 请求参数

```json
{
  "phone": "13800138000",           // 必填，手机号
  "phone_country_code": "+86"        // 可选，国家代码，默认+86
}
```

### 参数说明

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| phone | string | 是 | 手机号，长度7-20位 |
| phone_country_code | string | 否 | 国家代码，默认"+86" |

## 响应格式

### 成功响应 (200)

```json
{
  "code": 200,
  "message": "验证码发送成功",
  "data": null
}
```

### 错误响应

#### 手机号已存在 (200002)

```json
{
  "code": "200002",
  "message": "客户已存在",
  "data": null
}
```

#### 请求过于频繁 (200003)

```json
{
  "code": "200003",
  "message": "请求过于频繁，请稍后再试",
  "data": null
}
```

#### 参数无效 (900001)

```json
{
  "code": "900001",
  "message": "请求参数无效",
  "data": null
}
```

#### 短信发送失败 (200004)

```json
{
  "code": "200004",
  "message": "短信发送失败",
  "data": null
}
```

## 业务逻辑

1. **参数验证**
   - 验证手机号格式
   - 验证国家代码格式（如提供）
   - 参数不符合要求时，返回错误码 `900001`

2. **用户检查**
   - 检查手机号是否已被注册
   - 如已注册，返回错误码 `200002`

3. **频率限制**
   - 限制同一手机号发送频率（建议：1分钟内最多1次，1小时内最多5次）
   - 使用Redis缓存记录发送时间和次数
   - 超过频率限制时，返回错误码 `200003`

4. **验证码生成**
   - 生成6位数字验证码
   - 将验证码存储到Redis（设置过期时间，如5分钟）

5. **短信发送**
   - 调用短信服务发送验证码
   - 发送失败时，返回错误码 `200004`
   - 记录发送日志

## 与忘记密码接口对比

| 对比项 | 注册验证码接口 | 忘记密码验证码接口 |
|--------|----------------|-------------------|
| 接口路径 | `/api/cu/send-register-sms` | `/api/cu/forgot-password` |
| 用户存在检查 | 检查用户**不存在** | 检查用户**存在** |
| 验证码用途 | 手机号验证 | 密码重置 |
| 频率限制 | 较宽松 | 较严格 |
| 缓存键前缀 | `register_sms:` | `forgot_sms:` |

## 缓存设计

- **验证码存储**: `register_sms:{phone_country_code}:{phone}` (过期时间: 5分钟)
- **频率限制**: `register_sms_limit:{phone_country_code}:{phone}` (过期时间: 1小时)

## 安全考虑

1. 验证码只能使用一次，验证后立即删除
2. 限制发送频率，防止短信轰炸
3. 记录发送日志，便于审计
4. 支持图形验证码作为二次验证（可选）

## 后续流程

1. 用户收到验证码后，填写注册表单
2. 调用注册接口 `/api/cu/register`，提交手机号、验证码、密码等信息
3. 后端验证验证码正确性，完成注册流程